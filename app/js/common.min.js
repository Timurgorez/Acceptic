window.onload = function(){


document.forms.reg.onsubmit = function() {
	var name = document.getElementById('name').value;
	var email = document.getElementById('mail').value;
	var password = document.getElementById('password').value;


    if(!(/^[a-zA-Z0-9а-яА-ЯёЁ']{2,15}?$/.test(name))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели неразрешенные символы или длинна именни не влазит от 2 до 15 символов.</h4>";
        return false;
    }
 	if(!(/^[A-z0-9._-]+@[A-z0-9.-]+\.[A-z]{2,4}$/.test(email))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели некоректный EMAIL.</h4>";
        return false;
 	}
 	if(!(/^[A-z0-9._-]{6,15}?$/.test(password))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели неразрешенные символы или длинна пароля не влазит от 6 до 15 символов.</h4>";
        return false;
 	}

		var xhr = new XMLHttpRequest();
		var user = 'name=' + name + '&mail=' + email + '&password=' + password;
		xhr.open('POST', 'http://acceptic/app/regoop.php', true);
		xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		xhr.onreadystatechange = function () {
            if (xhr.status == 200 && xhr.readyState == 4) {
                if (~xhr.responseText.indexOf("Пользователь")) {
                    $('#infoModal').modal('show');
                    document.getElementById('modal-body').innerHTML = "<h4>" + xhr.responseText + "</h4>";
                    return false;
                } else {
                    var content = document.getElementById('content');
                    $('#infoModal').modal('show');
                    document.getElementById('exampleModalLabel').innerHTML = "<h3>Поздравляем!</h3>";
                    document.getElementById('modal-body').innerHTML = "<h4>Good job " + xhr.responseText + "</h4>";
                    document.getElementById("formReg").reset();
                }
            } else {
                console.log(xhr.status);
            }
        }
		xhr.send(user);
	return false;
  }





document.forms.sign.onsubmit = function() {
    var name = document.getElementById('nameSign').value;
	var password = document.getElementById('passwordSign').value;

    if(!(/^[a-zA-Z0-9а-яА-ЯёЁ']{2,15}?$/.test(name))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели неразрешенные символы или длинна именни не влазит от 2 до 15 символов.</h4>";
        return false;
    }

    if(!(/^[A-z0-9._-]{6,15}?$/.test(password))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели неразрешенные символы или длинна пароля не влазит от 6 до 15 символов.</h4>";
        return false;
    }

	var xhr = new XMLHttpRequest();
	var user = 'name=' + name + '&password=' + password;
	xhr.open('POST', 'http://acceptic/app/signoop.php', true);
	xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	xhr.onreadystatechange = function () {
		if(xhr.status == 200 && xhr.readyState == 4){

			if(~xhr.responseText.indexOf("Такого юзера в базе нет") || xhr.responseText === ''){
                var infoModal = document.getElementById('infoModal');
                $('#infoModal').modal('show');
                document.getElementById('modal-body').innerHTML = xhr.responseText;
				return false;
			}else{
			var content = document.getElementById('contentCh');
                $('#infoModal').modal('show');
                document.getElementById('modal-body').innerHTML = "<p>Добро пожаловать</p>";
			document.getElementById("formSign").reset();
			document.getElementById("change").style.display = "block";
			document.getElementById("mainForms").style.display = "none";
			content.innerHTML = xhr.responseText;
            }

		}else{
			console.log( xhr.status + ': ' + xhr.statusText + "  " + xhr.readyState);
		}
	}
	xhr.send(user);
	return false;
  }



document.forms.change.onsubmit = function() {
	var name = document.getElementById('nameCh').value;
	var email = document.getElementById('mailCh').value;
	var password = document.getElementById('passwordCh').value;
    var checkMail = document.getElementById('checkMail').innerHTML;

 	if(!(/^[a-zA-Z0-9а-яА-ЯёЁ']{2,15}?$/.test(name))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<p>Вы ввели неразрешенные символы или длинна именни не влазит от 2 до 15 символов.</p>";
        return false;
 	}

    if(!(/^[A-z0-9._-]+@[A-z0-9.-]+\.[A-z]{2,4}$/.test(email))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели некоректный EMAIL.</h4>";
        return false;
    }

    if(!(/^[A-z0-9._-]{6,15}?$/.test(password))){
        $('#infoModal').modal('show');
        document.getElementById('modal-body').innerHTML = "<h4>Вы ввели неразрешенные символы или длинна пароля не влазит от 6 до 15 символов.</h4>";
        return false;
    }

		var xhr = new XMLHttpRequest();
		var user = 'nameCh=' + name + '&mailCh=' + email + '&passwordCh=' + password + '&checkMail=' + checkMail;
		xhr.open('POST', 'http://acceptic/app/changeoop.php', true);
		xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		xhr.onreadystatechange = function () {
			if(xhr.status == 200 && xhr.readyState == 4){
                if (~xhr.responseText.indexOf("already exists")){
                    if(~xhr.responseText.indexOf("This email")){
                        $('#infoModal').modal('show');
                        document.getElementById('modal-body').innerHTML = "<h4>Этот EMAIL уже зарегистрирован!</h4>"
                    }else{
                        $('#infoModal').modal('show');
                        document.getElementById('modal-body').innerHTML = "<h4>Это имя уже зарегистрировано!</h4>"
                    }
                }else{
                    var content = document.getElementById('contentCh');
                    content.innerHTML = xhr.responseText;

				}
			}else{
				console.log(xhr.status);
			}
		}
		xhr.send(user);
		
	
	return false;
  }





















}




















